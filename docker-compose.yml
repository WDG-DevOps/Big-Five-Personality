version: '3.8'

services:
  app:
    # image: apanyaclay/bigfive-app:latest
    build: .
    container_name: bigfive-app
    ports:
      - "6060:6060"
    env_file:
      - .env
    depends_on:
      - db # Bilang ke 'app' untuk menunggu 'db' nyala dulu
      - prediction-service
    networks:
      - bigfive-net
    
  # Service 1: Prediction Service
  prediction-service:
    image: apanyaclay/bigfive-prediction:latest
    container_name: bigfive-prediction
    ports:
      - "5000:5000"
    networks:
      - bigfive-net

  # Service 2: Database MySQL
  db:
    image: mysql:8.0
    container_name: bigfive-db
    ports:
      # Map port 3306 di laptop Anda (agar bisa diakses tools spt DBeaver)
      - "3306:3306"
    environment:
      # Set password root dan database yang akan dibuat
      - MYSQL_ROOT_PASSWORD=passwordrahasiaanda # Ganti ini
      - MYSQL_DATABASE=bigfive_db
    volumes:
      # Menyimpan data database secara permanen di laptop Anda
      - mysql-data:/var/lib/mysql
    networks:
      - bigfive-net

# Definisikan volume untuk persistensi data
volumes:
  mysql-data:

# Definisikan network kustom
networks:
  bigfive-net: